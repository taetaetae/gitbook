# 4. 오류
- 코드가 실행되는 환경은 불완전하다.
- 오류에 대해 생각할때 구분이 필요
  - 소프트웨어가 작동을 계속할 수 있는 오류
  - 작동을 계속할 합리적인 방법이 없는 오류

## 4.1 복구 가능성
### 4.1.1 복구 가능한 오류
- 일반적으로 시스템 외부의 무언가에 의해 야기되는 오류에 대해서는 대부분 시스템 전체가 표나지 않고 적절하게 처리하기 위해 노력해야 한다.
- 중요한 점은, 시스템 전체를 지칭한다는 점
- 복구 가능한 오류의 예
  - 잘못된 번호를 입력했을때 유효하지 않다는 오류 메시지를 제공
  - 자신의 코드가 의존하는 서비스에 연결할 수 없는 경우 네트워크 연결을 확인하도록 요청해야 함
  - 서비스 사용에 대한 어떤 통계를 기록하는 등의 그다지 중요하지 않는 오류가 발생한다면 계속 실행해도 무방

### 4.1.2 복구할 수 없는 오류
- 개발자가 코드의 어느 부분에서 뭔가를 망쳐놓은 경우
- 이때는 피해를 최소화하고 개발자가 문제를 발견하고 해결할 가능성을 최대화 해야한다.
- 이후 이야기 할 신속한 실패(failing fast)와 요란한 실패(failing loudly)의 개념

### 4.1.3 호출하는 쪽에서만 오류 복구 가능 여부를 알 때가 많다
- 대부분의 오류는 한 코드가 다른 코드를 호출할 때 발생
- 따라서 다음을 신중하게 고려
  - 오류로부터 복구하기를 호출하는 쪽에서 원하는가?
  - 만약 그렇다면 오류를 처리할 필요가 있다는 것을 호출하는 쪽에서는 어떻게 알 수 있을까?
- 코드는 종종 재사용 되고 여러곳에서 호출 되기 때문에 코드의 잠재적 호출자에 대한 가정을 가능한 한 하지 않는것이 좋다.

```java
class PhoneNumber {
    static PhoneNumber parse(String number){
        if (!isValidPhoneNumber(number)) {
            // 에러를 처리하기 위한 코드 <- 프로그램이 복구할 수 있는가?
        }
    } 
}
```
  - 어디서 어떻게 사용되는지 모르면 오류를 복구하기 어렵다.

```java
PhoneNumber getHeadOfficeNumber() {
    return PhoneNumber.parse("01234bbbbb4556");
}
```
  - 이처럼 잘못된 입력값을 하드코딩 해놨다면 프로그래밍 오류다.
  - 복구할 방법이 없다.

```java
PhoneNumber getUserPhoneNumber(UserInput input) {
    return PhoneNumber.parse(input.getPhoneNumber());
}
``` 
  - 입력을 받아 실행될 경우 복구가 가능하다.
  - 사용자의 입력이 잘못되었음을 알리는 오류메세지가 필요하다.

- 자신의 코드가 어떻게 사용되어야 하는지에 대해 스스로에게는 명백해 보일 수 있을지라도 다른사람들에게는 분명하지 않을 수도 있다는 점을 이해해야 한다.
- 코드 계약이 명확해야 하고, 호출하는 쪽에서 함수를 호출하기 전에 입력을 검증하는 쉽고 분명한 방법이 있어야 한다.

### 4.1.4 호출하는 쪽에서 복구하고자 하는 오류에 대해 인지하도록 하라
- 다른코드가 자신의 코드를 호출할 경우, 호출 시 오류가 발생한다는 것을 사전에 알 수 있는 실질적인 방법이 없는 경우가 많다.
- 그렇기 때문에 오류가 발생할 수 있다는 가능성을 호출하는 쪽에서 확실하게 인지하도록 해야 한다.
- 그렇지 않으면 개발자의 예상과는 다른 결과를 초래하여 사용자가 버그를 마주할 수 있다.

## 4.2 견고성 vs 실패
- 오류가 발생할 때, 다음 중 하나르 선택
  - 실패, 상위 계층으로 전파 하거나 전체 프로그램의 작동을 멈춘다.
  - 오류를 처리하고 계속 진행한다.

### 4.2.1 신속하게 실패해라
- 가능한 한 문제의 실제 발생 지점으로부터 가까운 곳에서 오류를 나타내는 것 (+ StackTrace)
- 소프트웨어가 의도치 않게 잠재적으로 위험한 상태가 되는것을 방지
  - 복구할 수 있는 오류 : 호출하는 쪽에서 오류로부터 훌륭하고 안전하게 복구할 수 있는 기회를 최대한 제공
  - 복구할 수 없는 오류 : 개발자가 문제를 신속하게 파악하고 해결할 수 있는 기회를 최대한 제공

### 4.2.2 요란하게 실패해라
- 오류가 발생하는데도 불구하고 아무도 모르는 상황을 막고자 하는것
- 가장 명백한(그리고 강압적인) 방법은 예외(또는 이와 유사한 것)를 발생시켜 프로그램을 중단되게 하는 것
- 로깅은 다소 약한 효과 (로그 확인 타이밍, 다른 로그와 겹치는 경우)

### 4.2.3 복구 가능성의 범위
- 한 번의 잘못된 요청으로 전체 서버의 동작이 멈추는 것은 바람직 하지 않기에 견고하게 작성해야 한다.
- 오류 발생시 요란하게 실패해야 한다.
- 이 두 목표가 양립하기란 어렵다.
- 오류가 발견되면 기록하고 모니터링 하며 임계치를 벗어날 경우 알림을 준다.

### 4.2.4 오류를 숨기지 않음
- 오류를 숨길 경우 호출하는 쪽에서 오류로부터 복구할수 있는 기회를 없애는 것
- 복구할 수 없는 오류를 숨기면 프로그래밍 오류가 감춰진다.
- 오류를 숨기는 방법 (이러면 안된다.)
  - 기본값 반환 : 오류가 발생했지만 정상처럼 진행
  - 널 객체 패턴 : 기본값과 비슷한 상황. 빈 리스트 같은 것을 리턴
  - 아무것도 하지 않음
    - 반환하지 않고 단지 어떤 작업을 수행하는 경우 오류 발생시 아무것도 안하는 상황
    - 예외를 감싸서 무시
    - 예외를 감싸서 오류만 로깅 (상위로 전파가 되어야 한다.) 

## 4.3 오류 전달 방법

## 4.4 복구할 수 없는 오류의 전달

## 4.5 호출하는 쪽에서 복구하기를 원할 수도 있는 오류의 전달

## 4.6 컴파일러 경고를 무시하지 말라